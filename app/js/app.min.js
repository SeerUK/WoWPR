var ApiClient=function(a,b){var c=function(c,d){var e=b.defer();return a.get("proxy.php?region="+c+"&uri="+d).success(function(a,b,c,d){e.resolve({data:a,status:b,headers:c,config:d})}).error(function(a,b,c,d){e.reject({data:a,status:b,headers:c,config:d})}),e.promise};return{findCharacter:function(a,b,d){return c(a,"/api/wow/character/"+b+"/"+d)},findFullCharacter:function(a,b,d){return c(a,"/api/wow/character/"+b+"/"+d+"?fields=titles,items,professions,progression")},findRealms:function(a){return c(a,"/api/wow/realm/status")}}},CharacterDataHelper=function(){return{getActiveTitleFromTitles:function(a){for(i=0;i<a.length;i++)if("undefined"!=typeof a[i].selected&&1==a[i].selected)return a[i].name.replace("%s","").replace(/^[, ]|[, ]$/g,"");return!1},getClassNameById:function(a){switch(a){case 1:return"Warrior";case 2:return"Paladin";case 3:return"Hunter";case 4:return"Rogue";case 5:return"Priest";case 6:return"Death Knight";case 7:return"Shaman";case 8:return"Mage";case 9:return"Warlock";case 10:return"Monk";case 11:return"Druid";default:return"Not implemented"}},getClassSlugById:function(a){switch(a){case 1:return"warrior";case 2:return"paladin";case 3:return"hunter";case 4:return"rogue";case 5:return"priest";case 6:return"death-knight";case 7:return"shaman";case 8:return"mage";case 9:return"warlock";case 10:return"monk";case 11:return"druid";default:return"Not implemented"}},getFactionByRaceId:function(a){switch(a){case 1:case 3:case 4:case 7:case 11:case 22:case 25:return"alliance";case 2:case 5:case 6:case 8:case 9:case 10:case 26:return"horde";default:return"Not implemented"}},getRaceById:function(a){switch(a){case 1:return"human";case 2:return"orc";case 3:return"dwarf";case 4:return"night elf";case 5:return"undead";case 6:return"tauren";case 7:return"gnome";case 8:return"troll";case 9:return"goblin";case 10:return"blood elf";case 11:return"draenei";case 22:return"worgen";case 25:case 26:return"pandaren";default:return"Not implemented"}}}},ConfigManager=function(a){var b=a.get("wowpr.config")||{};return{get:function(a){return b[a]||!1},set:function(c,d){return b[c]=d,a.set("wowpr.config",b),this}}},ScoreCalculator=function(){return{getAchievementScore:function(a){return Math.round(.5*a.achievementPoints)},getGearScore:function(a){var b=0;for(var c in a)if(a.hasOwnProperty(c)&&"object"==typeof a[c]&&"tabard"!=c){var d=.5;"mainHand"==c&&"undefined"==typeof a.offHand&&(d=1),b+=Math.round(a[c].itemLevel*d*a[c].quality)}return b},getProfessionsScore:function(a){var b=a.primary,c=0;for(var d in b)c+=b[d].rank;return c},getRaidScore:function(a){var b=a.raids,c=0;for(var d in b)c+=100*b[d].normal,c+=100*b[d].heroic;return c},getScore:function(a){var b=0,c={achievements:this.getAchievementScore(a),gear:this.getGearScore(a.items),professions:this.getProfessionsScore(a.professions),raids:this.getRaidScore(a.progression)};for(var d in c)b+=c[d];for(var d in c)c[d]={score:c[d],percentage:Math.round(c[d]/b*100)};return c.total=b,c}}},SpinnerHelper=function(){var a={};return a.logo=angular.element(document.getElementById("logo")),a.spinner=angular.element(document.getElementById("spinner")),{hideSpinner:function(){a.logo.removeClass("hide"),a.spinner.removeClass("active")},showSpinner:function(){a.logo.addClass("hide"),a.spinner.addClass("active")}}},StorageEngine=function(a){var b=function(){return"undefined"==typeof Storage?!1:!0};return{get:function(c){return b?JSON.parse(localStorage.getItem(c)):a.get(c)},set:function(c,d){return b?localStorage.setItem(c,JSON.stringify(d)):a.put(c,d),this},unset:function(c){return b?localStorage.removeItem(c):a.remove(c),this}}};angular.module("wowpr",["ngAnimate","ngCookies","ngRoute","highcharts-ng","wowpr.filters","wowpr.services","wowpr.directives","wowpr.controllers"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"partials/home.html",controller:"HomeCtrl"}),a.when("/character/:realm/:name",{templateUrl:"partials/character.html",controller:"CharacterCtrl"}),a.otherwise({redirectTo:"/"})}]),angular.module("wowpr.controllers",[]).controller("HomeCtrl",["$scope","$q","$http","$location","$templateCache","ApiClient","CharacterDataHelper","ConfigManager","SpinnerHelper",function(a,b,c,d,e,f,g,h,i){h.get("region")||h.set("region","eu");var j={};j.regionChange=function(){h.set("region",a.region),i.showSpinner(),f.findRealms(a.region).then(function(b){i.hideSpinner(),a.realms=b.data.realms,a.doSearch=function(){a.error=null,i.showSpinner(),f.findCharacter(a.region,a.formData.realm,a.formData.name).then(function(b){i.hideSpinner(),"{}"!==JSON.stringify(b.data)?(a.response=b.data,d.path("/character/"+a.formData.realm+"/"+a.formData.name)):a.error="The armory has not updated this character."},function(b){i.hideSpinner(),a.error=b.data.reason})}})},j.updateCharacterPreview=function(){return a.region&&a.formData.realm&&a.formData.name?(a.error=null,i.showSpinner(),void f.findCharacter(a.region,a.formData.realm,a.formData.name).then(function(b){i.hideSpinner(),b.data.thumbnail&&(b.data.profileMain=b.data.thumbnail.replace("avatar.jpg","profilemain.jpg")),b.data.factionName=g.getFactionByRaceId(b.data.race),a.character=b.data},function(){i.hideSpinner(),delete a.character})):!1};var k;a.$watch("region",j.updateCharacterPreview),a.$watch("formData.realm",j.updateCharacterPreview),a.$watch("formData.name",function(){i.hideSpinner(),clearTimeout(k),k=setTimeout(function(){j.updateCharacterPreview()},400)}),a.regions=[{name:"Europe",value:"eu"},{name:"United States",value:"us"},{name:"Korea",value:"kr"},{name:"Taiwan",value:"tw"}],a.region=h.get("region"),a.$watch("region",j.regionChange),c.get("partials/character.html",{cache:e})}]).controller("CharacterCtrl",["$scope","$http","$location","$routeParams","$templateCache","ApiClient","CharacterDataHelper","ConfigManager","ScoreCalculator","SpinnerHelper",function(a,b,c,d,e,f,g,h,i,j){h.get("region")||c.path("/");var k={};k.region=h.get("region"),j.showSpinner(),f.findFullCharacter(k.region,d.realm,d.name).then(function(b){j.hideSpinner(),b.data.thumbnail&&(b.data.profileMain=b.data.thumbnail.replace("avatar.jpg","profilemain.jpg")),b.data.className=g.getClassNameById(b.data.class),b.data.classSlug=g.getClassSlugById(b.data.class),b.data.factionName=g.getFactionByRaceId(b.data.race),b.data.region=k.region,b.data.realmSlug=d.realm,b.data.title=g.getActiveTitleFromTitles(b.data.titles),a.jsonString=JSON.stringify({test:"test"}),a.character=b.data,a.scores=i.getScore(a.character),a.scoreChartConfig={options:{chart:{backgroundColor:null,plotBackgroundColor:null,plotBorderWidth:null,plotShadow:null},colors:["#3498db","#9b59b6","#e74c3c","#1abc9c"],plotOptions:{pie:{borderColor:"#34495e",borderWidth:"3px",dataLabels:{enabled:!1}}}},series:[{type:"pie",data:[["Gear",a.scores.gear.percentage],["Raids",a.scores.raids.percentage],["Professions",a.scores.professions.percentage],["Achievements",a.scores.achievements.percentage]]}],title:{text:""},credits:{enabled:!1},loading:!1}},function(b){j.hideSpinner(),a.error=b.data.reason}),b.get("partials/home.html",{cache:e})}]),angular.module("wowpr.directives",[]).directive("asideMenuButton",[function(){return{restrict:"A",link:function(a,b,c){var d=angular.element(document.getElementById(c.parent)),e=angular.element(document.getElementsByTagName("body")),f=function(){d.removeClass("active")},g=function(){d.addClass("active")};e.on("click",function(){d.hasClass("active")&&f()}),d.on("click",function(a){a.stopPropagation()}),b.on("click",function(a){a.preventDefault(),a.stopPropagation(),d.hasClass("active")?f():g()})}}}]),angular.module("wowpr.filters",[]).filter("interpolate",["version",function(a){return function(b){return String(b).replace(/\%VERSION\%/gm,a)}}]),angular.module("wowpr.services",[]).service("ApiClient",["$http","$q",ApiClient]).service("CharacterDataHelper",[CharacterDataHelper]).service("ConfigManager",["StorageEngine",ConfigManager]).service("ScoreCalculator",[ScoreCalculator]).service("SpinnerHelper",[SpinnerHelper]).service("StorageEngine",["$cookieStore",StorageEngine]);